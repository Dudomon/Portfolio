
# üö® ULTRA-AGGRESSIVE DEBUG PATCH
# Adicionar no IN√çCIO do m√©todo step() em daytrader.py

def step(self, action):
    """Executa um passo no ambiente."""
    
    # üö® ULTRA DEBUG: Log TODA a√ß√£o recebida
    print(f"\nüîç [ULTRA DEBUG] A√á√ÉO RECEBIDA:")
    print(f"   Raw: {action}")
    print(f"   Type: {type(action)}")
    print(f"   Shape: {getattr(action, 'shape', 'N/A')}")
    print(f"   Is scalar: {np.isscalar(action)}")
    if hasattr(action, 'shape'):
        print(f"   Shape == (): {action.shape == ()}")
    
    # üö® FOR√áAR AN√ÅLISE DETALHADA
    if hasattr(action, '__len__') and len(action) > 0:
        print(f"   √â array com {len(action)} elementos")
        print(f"   Primeiro elemento: {action[0]} (entry_decision)")
        
        # FOR√áAR CONVERS√ÉO PARA INT E AN√ÅLISE
        try:
            entry_decision = int(action[0])
            actions_names = ['HOLD', 'LONG', 'SHORT']
            action_name = actions_names[entry_decision] if 0 <= entry_decision <= 2 else 'INVALID'
            print(f"   Entry Decision: {entry_decision} ({action_name})")
            
            # CONTADOR FOR√áADO DE A√á√ïES
            if not hasattr(self, '_forced_action_counter'):
                self._forced_action_counter = {'HOLD': 0, 'LONG': 0, 'SHORT': 0, 'INVALID': 0}
            
            if action_name in self._forced_action_counter:
                self._forced_action_counter[action_name] += 1
            else:
                self._forced_action_counter['INVALID'] += 1
            
            # LOG A CADA 50 A√á√ïES
            total_actions = sum(self._forced_action_counter.values())
            if total_actions % 50 == 0:
                print(f"\nüìä [FORCED COUNTER] {total_actions} a√ß√µes processadas:")
                for action_type, count in self._forced_action_counter.items():
                    pct = (count / total_actions) * 100
                    print(f"   {action_type}: {count} ({pct:.1f}%)")
                
                if self._forced_action_counter['SHORT'] == 0:
                    print(f"   üö® ALERTA: AINDA ZERO SHORT AP√ìS {total_actions} A√á√ïES!")
                else:
                    print(f"   ‚úÖ SHORT DETECTADO: {self._forced_action_counter['SHORT']} vezes")
        
        except Exception as e:
            print(f"   ‚ùå ERRO ao processar entry_decision: {e}")
    
    else:
        print(f"   üö® A√á√ÉO √â SCALAR OU VAZIA!")
        # Aplicar corre√ß√£o scalar aqui...
    
    # Continuar com o c√≥digo original...

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Teste Click Chatbot</title>
    <link rel="stylesheet" href="chatbot.css">
    <style>
        body {
            padding: 20px;
            background: #f0f0f0;
        }
        #debug {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #000;
            color: #0f0;
            padding: 20px;
            border-radius: 10px;
            font-family: monospace;
            max-width: 400px;
            z-index: 99999;
            max-height: 80vh;
            overflow-y: auto;
        }
        .event { margin: 5px 0; }
        .error { color: #f00; }
        .success { color: #0f0; }
        .warning { color: #ff0; }
    </style>
</head>
<body>
    <div id="debug">
        <h3 style="color: #0ff;">üîç Debug do Click</h3>
        <div id="log"></div>
    </div>

    <h1>Teste de Click do Chatbot</h1>
    <p>Clique no √≠cone laranja no canto inferior direito</p>

    <script src="chatbot.js"></script>
    <script>
        const log = document.getElementById('log');

        function addLog(msg, type = 'info') {
            const div = document.createElement('div');
            div.className = 'event ' + type;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${msg}`;
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }

        addLog('P√°gina carregada');

        // Aguarda DOM carregar
        document.addEventListener('DOMContentLoaded', function() {
            addLog('DOMContentLoaded disparado');

            try {
                // Inicializa chatbot
                if (typeof RadioChatbot !== 'undefined') {
                    addLog('‚úì RadioChatbot encontrado', 'success');

                    window.chatbotInstance = new RadioChatbot({
                        apiUrl: '/chatbot/chat_api.php',
                        botName: 'Chatinho',
                        position: 'bottom-right',
                        debug: true
                    });

                    addLog('‚úì Chatbot inicializado', 'success');

                    // Aguarda um pouco e verifica o bot√£o
                    setTimeout(() => {
                        const toggle = document.getElementById('chatbot-toggle');
                        const chatbot = document.getElementById('radio-chatbot');

                        if (toggle) {
                            addLog('‚úì Bot√£o #chatbot-toggle encontrado', 'success');
                            addLog(`Dimens√µes: ${toggle.offsetWidth}x${toggle.offsetHeight}px`);
                            addLog(`Vis√≠vel: ${toggle.offsetParent !== null ? 'SIM' : 'N√ÉO'}`);

                            // Adiciona listener de click manual
                            toggle.addEventListener('click', function(e) {
                                addLog('üñ±Ô∏è CLICK DETECTADO!', 'warning');
                                addLog(`Event target: ${e.target.tagName}`);
                                addLog(`Classes: ${chatbot.className}`);

                                // For√ßa abertura manual
                                if (chatbot.classList.contains('open')) {
                                    addLog('Chatbot est√° ABERTO, fechando...', 'warning');
                                    chatbot.classList.remove('open');
                                } else {
                                    addLog('Chatbot est√° FECHADO, abrindo...', 'warning');
                                    chatbot.classList.add('open');
                                }
                            });

                            addLog('‚úì Event listener de click adicionado', 'success');

                        } else {
                            addLog('‚ùå Bot√£o #chatbot-toggle N√ÉO encontrado!', 'error');
                        }

                        if (chatbot) {
                            addLog('‚úì Container #radio-chatbot encontrado', 'success');
                            addLog(`Classes: ${chatbot.className}`);
                        } else {
                            addLog('‚ùå Container #radio-chatbot N√ÉO encontrado!', 'error');
                        }

                    }, 1000);

                } else {
                    addLog('‚ùå RadioChatbot N√ÉO definido!', 'error');
                }

            } catch (error) {
                addLog('‚ùå ERRO: ' + error.message, 'error');
                addLog('Stack: ' + error.stack, 'error');
            }
        });

        // Captura todos os erros JS
        window.addEventListener('error', function(e) {
            addLog('‚ùå JS Error: ' + e.message, 'error');
            addLog(`Linha: ${e.lineno}, Coluna: ${e.colno}`, 'error');
        });

        // Captura todos os clicks na p√°gina
        document.addEventListener('click', function(e) {
            if (e.target.closest('#chatbot-toggle')) {
                addLog('üñ±Ô∏è Click no bot√£o do chatbot!', 'warning');
            }
        }, true); // useCapture = true para pegar antes de bubbling

    </script>
</body>
</html>

{% extends "base.html" %}

{% block title %}Relatórios - CropLink{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-6">
                <i class="fas fa-chart-bar text-info"></i>
                Relatórios Gerais
            </h1>
            <p class="text-muted">Visão geral e simplificada dos dados do sistema</p>
        </div>
    </div>

    <!-- Resumo Geral -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-primary text-white">
                <div class="card-body text-center">
                    <i class="fas fa-warehouse fa-2x mb-2"></i>
                    <h6>Total de Silos</h6>
                    <h3>{{ dados.resumo.total_silos }}</h3>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-success text-white">
                <div class="card-body text-center">
                    <i class="fas fa-users fa-2x mb-2"></i>
                    <h6>Funcionários</h6>
                    <h3>{{ dados.resumo.total_funcionarios }}</h3>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-info text-white">
                <div class="card-body text-center">
                    <i class="fas fa-boxes fa-2x mb-2"></i>
                    <h6>Insumos</h6>
                    <h3>{{ dados.resumo.total_insumos }}</h3>
                </div>
            </div>
        </div>
        
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card bg-warning text-white">
                <div class="card-body text-center">
                    <i class="fas fa-tractor fa-2x mb-2"></i>
                    <h6>Equipamentos</h6>
                    <h3>{{ dados.resumo.total_maquinas }}</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Situação dos Silos -->
    <div class="card shadow mb-4">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="fas fa-warehouse text-primary"></i>
                Situação dos Silos
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4 text-center">
                    <h6 class="text-muted">Capacidade Total</h6>
                    <h4 class="text-primary">{{ "{:,.0f}".format(dados.resumo.capacidade_total) }} kg</h4>
                    <small class="text-muted">{{ "{:,.0f}".format(dados.resumo.capacidade_total / 60) }} sacas</small>
                </div>
                <div class="col-md-4 text-center">
                    <h6 class="text-muted">Estoque Atual</h6>
                    <h4 class="text-success">{{ "{:,.0f}".format(dados.resumo.estoque_total) }} kg</h4>
                    <small class="text-muted">{{ "{:,.0f}".format(dados.resumo.estoque_total / 60) }} sacas</small>
                </div>
                <div class="col-md-4 text-center">
                    <h6 class="text-muted">Ocupação</h6>
                    <h4 class="{% if dados.resumo.ocupacao_percentual > 80 %}text-danger{% elif dados.resumo.ocupacao_percentual > 60 %}text-warning{% else %}text-success{% endif %}">
                        {{ "%.1f"|format(dados.resumo.ocupacao_percentual) }}%
                    </h4>
                </div>
            </div>
            
            <!-- Barra de Progresso -->
            <div class="mt-3">
                <div class="progress" style="height: 20px;">
                    <div class="progress-bar 
                        {% if dados.resumo.ocupacao_percentual > 80 %}bg-danger
                        {% elif dados.resumo.ocupacao_percentual > 60 %}bg-warning
                        {% else %}bg-success{% endif %}" 
                        style="width: {{ dados.resumo.ocupacao_percentual }}%;">
                        {{ "%.1f"|format(dados.resumo.ocupacao_percentual) }}%
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Lista de Silos -->
        <div class="col-lg-6">
            <div class="card shadow">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-list text-secondary"></i>
                        Status dos Silos
                    </h5>
                </div>
                <div class="card-body">
                    {% if dados.silos %}
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Silo</th>
                                        <th>Estoque</th>
                                        <th>Ocupação</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for silo in dados.silos %}
                                    <tr>
                                        <td>{{ silo.nome }}</td>
                                        <td>{{ "{:,.0f}".format(silo.get_estoque_total()) }} kg</td>
                                        <td>
                                            {% set ocupacao = (silo.get_estoque_total() / silo.capacidade_kg * 100) if silo.capacidade_kg > 0 else 0 %}
                                            <span class="badge 
                                                {% if ocupacao > 80 %}bg-danger
                                                {% elif ocupacao > 60 %}bg-warning
                                                {% else %}bg-success{% endif %}">
                                                {{ "%.0f"|format(ocupacao) }}%
                                            </span>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted text-center">Nenhum silo cadastrado</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Movimentações Recentes e Alertas -->
        <div class="col-lg-6">
            <!-- Insumos com Baixo Estoque -->
            {% if dados.insumos_baixo_estoque %}
            <div class="card shadow mb-3">
                <div class="card-header bg-warning text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-exclamation-triangle"></i>
                        Insumos com Baixo Estoque
                    </h6>
                </div>
                <div class="card-body">
                    {% for insumo in dados.insumos_baixo_estoque %}
                    <div class="d-flex justify-content-between border-bottom py-1">
                        <span>{{ insumo.nome }}</span>
                        <span class="text-danger">{{ insumo.quantidade }} {{ insumo.unidade }}</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Movimentações Recentes -->
            <div class="card shadow">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-clock text-info"></i>
                        Últimas Movimentações
                    </h6>
                </div>
                <div class="card-body">
                    {% if dados.movimentacoes_recentes %}
                        {% for mov in dados.movimentacoes_recentes[:5] %}
                        <div class="d-flex justify-content-between align-items-center border-bottom py-2">
                            <div>
                                <strong>{{ mov.silo.nome }}</strong> - {{ mov.grao.nome }}<br>
                                <small class="text-muted">{{ mov.data_movimentacao.strftime('%d/%m %H:%M') }}</small>
                            </div>
                            <div class="text-end">
                                <span class="badge {% if mov.tipo_movimentacao == 'Entrada' %}bg-success{% else %}bg-danger{% endif %}">
                                    {% if mov.tipo_movimentacao == 'Entrada' %}+{% else %}-{% endif %}{{ "{:,.0f}".format(mov.quantidade_kg) }} kg
                                </span>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted text-center">Nenhuma movimentação recente</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}